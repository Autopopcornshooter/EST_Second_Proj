<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>게시물</title>
    <link rel="icon" type="image/png" th:href="@{/images/BaeMin-main.jpg}">
  <link rel="stylesheet" th:href="@{/css/region.css}">
  <link rel="stylesheet" th:href="@{/css/admin.css}">
</head>
<body>

<header>
    <div class="logo">
        <a th:href="@{/admin/users}">
            <img th:src="@{/images/BaeMin_Logo.jpeg}" alt="배달의민족 로고">
        </a>
    </div>
    <form th:action="@{/admin/logout}" method="post">
        <button type="submit" class="logout-btn">로그아웃</button>
    </form>
</header>

<script type="text/javascript">
  function confirmToggle(form) {
    // form 안 hidden input에서 현재 상태 읽기
    let currentState = form.querySelector('input[name=state]').value.trim();
    let targetState = (currentState === '공개') ? '비공개' : '공개';
    return confirm("'" + targetState + "' 상태로 변경하시겠습니까?");
  }

  function submitSearch() {
    const keyword = document.getElementById('keywordInput').value.trim();
    if (keyword === "") {
      window.location.href = "/admin/articles";
    } else {
      window.location.href = `/admin/articles/search/${encodeURIComponent(keyword)}/1`;
    }
  }
</script>

<div class="container">
  <div th:replace="~{admin-sidebar :: sidebar}"></div>

  <div class="main">
    <div class="search-bar">
      <form id="searchForm" method="get" onsubmit="submitSearch(); return false;">
        <input type="text" id="keywordInput" placeholder="상호명 입력" th:value="${keyword}"/>
        <button type="submit">검색</button>
      </form>
    </div>

    <div class="table">
      <table>
        <thead>
        <tr>
          <th>번호</th>
          <th>상호명</th>
          <th>대표 메뉴</th>
          <th>작성자</th>
          <th>지역</th>
          <th>등록일</th>
          <th>상태</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="restaurant : ${restaurants}">
          <td th:text="${restaurant.id}"></td>
          <td th:text="${restaurant.name}"></td>
          <td th:text="${restaurant.mainMenu}"></td>
          <td th:text="${restaurant.userName}"></td>
          <td th:text="${restaurant.address}"></td>
          <td th:text="${#temporals.format(restaurant.createdAt, 'yyyy-MM-dd')}"></td>
          <td>
            <form th:action="@{'/admin/articles/' + ${restaurant.id} + '/toggle'}"
                  method="post"
                  onsubmit="return confirmToggle(this);">
              <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
              <input type="hidden" name="state" th:value="${restaurant.state}" />
              <button type="submit" th:text="${restaurant.state}"></button>
            </form>
          </td>
        </tr>
        </tbody>
      </table>
      <div class="pagination">
        <!-- 이전 버튼 -->
        <a class="prev pagination-btn"
           th:if="${!isSearch} and ${restaurants.hasPrevious()}"
           th:href="@{/admin/articles(page=${restaurants.number - 1}, size=${restaurants.size})}">&lt;</a>

        <a class="prev pagination-btn"
           th:if="${isSearch} and ${restaurants.hasPrevious()}"
           th:href="@{/admin/articles/search/{keyword}/{page}(keyword=${keyword}, page=${restaurants.number})}">&lt;</a>

        <span class="page-info" th:text="${restaurants.number + 1} + ' / ' + ${restaurants.totalPages}"></span>

        <!-- 다음 버튼 -->
        <a class="next pagination-btn"
           th:if="${!isSearch} and ${restaurants.hasNext()}"
           th:href="@{/admin/articles(page=${restaurants.number + 1}, size=${restaurants.size})}">&gt;</a>

        <a class="next pagination-btn"
           th:if="${isSearch} and ${restaurants.hasNext()}"
           th:href="@{/admin/articles/search/{keyword}/{page}(keyword=${keyword}, page=${restaurants.number + 2})}">&gt;</a>
      </div>


    </div>
  </div>
</div>
</body>
</html>